%% Main model comparisons: Opt, Num, Num-V, Prop, and Prop-V (Fig 4c, S7c, S10c, S12c, S14c)
clear;

exp = 1;
[subarray,obsnum] = fun_exp2subarray2obsnum(exp);

modelarray = 1:5;

for subnum = subarray
    for modelnum = modelarray
        load(['fittingresult/' fun_modelnum2name(modelnum) '_sub' num2str(subnum) '.mat']);
        [aicc(modelnum,subnum),bic(modelnum,subnum)] = fun_aiccbic(- minusloglik_min,numel(p_min),obsnum);
    end
end

diffaicc = aicc - repmat(aicc(end,:),size(aicc,1),1);
diffbic = bic - repmat(bic(end,:),size(bic,1),1);

% boostrap
for modelnum = modelarray
    ci_aicc(:,modelnum) = bootci(10000,@mean,squeeze(diffaicc(modelnum,subarray)));
    ci_bic(:,modelnum) = bootci(10000,@mean,squeeze(diffbic(modelnum,subarray)));
end

figure; hold on;
errorbar(1:modelnum,mean(diffaicc(:,subarray),2),mean(diffaicc(:,subarray),2)-ci_aicc(1,:)',ci_aicc(2,:)'-mean(diffaicc(:,subarray),2),'k','linestyle','none','Linewidth',1);
set(gca,'XAxisLocation','origin');
set(gca,'xtick',1:modelnum,'xticklabel',{'Opt','Num','Prop','Num-V','Prop-V'})
set(gca,'fontsize',10);
xlabel('Model'); ylabel('AICc difference');
xtickangle(-45)
xlim([0 modelnum+1])
set(gca,'tickdir','out');
set(gca,'linewidth',1);
set(gca,'fontsize',20);

figure; hold on;
errorbar(1:modelnum,mean(diffbic(:,subarray),2),mean(diffbic(:,subarray),2)-ci_bic(1,:)',ci_bic(2,:)'-mean(diffbic(:,subarray),2),'k','linestyle','none','Linewidth',1);
set(gca,'XAxisLocation','origin');
set(gca,'xtick',1:modelnum,'xticklabel',{'Opt','Num','Prop','Num-V','Prop-V'})
set(gca,'fontsize',10);
xlabel('Model'); ylabel('AICc difference');
xtickangle(-45)
xlim([0 modelnum+1])
set(gca,'tickdir','out');
set(gca,'linewidth',1);
set(gca,'fontsize',20);

%% Prop-V vs Flexible-Threshold
clear;

exp = 1;
[subarray,obsnum] = fun_exp2subarray2obsnum(exp);

for subnum = subarray
    % Prop-V model
    load(['fittingresult/' fun_modelnum2name(5) '_sub' num2str(subnum) '.mat']);
    [aicc(1,subnum),bic(1,subnum)] = fun_aiccbic(- minusloglik_min,numel(p_min),obsnum);
    
    % Flexible-Threshold model
    load(['fittingresult/Flexible-Threshold model/thres39_sub' num2str(subnum) '.mat']);
    [aicc(2,subnum),bic(2,subnum)] = fun_aiccbic(- minusloglik_min,numel(p_min),obsnum);
end

diffaicc = aicc(2,subarray) - aicc(1,subarray);
ci_diffaicc = bootci(100000,@mean,squeeze(diffaicc))

diffbic = bic(2,subarray) - bic(1,subarray);
ci_diffbic = bootci(100000,@mean,squeeze(diffbic))

%% PropV vs PropVrisk (Fig S7)
clear;

exp = 1;
[subarray,obsnum] = fun_exp2subarray2obsnum(exp);

modelarray = [1:5 7];

for subnum = subarray
    for modelnum = modelarray
        load(['fittingresult/' fun_modelnum2name(modelnum) '_sub' num2str(subnum) '.mat']);
        loglik(modelnum,subnum) = - minusloglik_min;
        [aicc(modelnum,subnum),bic(modelnum,subnum)] = fun_aiccbic(- minusloglik_min,numel(p_min),obsnum);
    end
end

diffaicc = aicc - repmat(aicc(5,:),size(aicc,1),1);
diffbic = bic - repmat(bic(5,:),size(bic,1),1);

% boostrap
for modelnum = modelarray
    ci_aicc(:,modelnum) = bootci(10000,@mean,squeeze(diffaicc(modelnum,subarray)));
    ci_bic(:,modelnum) = bootci(10000,@mean,squeeze(diffbic(modelnum,subarray)));
end

figure; hold on;
errorbar(1:numel(modelarray),mean(diffaicc(modelarray,subarray),2),mean(diffaicc(modelarray,subarray),2)-ci_aicc(1,modelarray)',ci_aicc(2,modelarray)'-mean(diffaicc(modelarray,subarray),2),'k','linestyle','none','Linewidth',1);
set(gca,'XAxisLocation','origin');
set(gca,'xtick',1:modelnum,'xticklabel',{'Opt','Num','Prop','Num-V','Prop-V','Prop-V-risk'})
set(gca,'fontsize',10);
xlabel('Model'); ylabel('AICc difference');
xtickangle(-45)
xlim([0 numel(modelarray)+1])
set(gca,'tickdir','out');
set(gca,'linewidth',1);
set(gca,'fontsize',20);

figure; hold on;
errorbar(1:numel(modelarray),mean(diffbic(modelarray,subarray),2),mean(diffbic(modelarray,subarray),2)-ci_bic(1,modelarray)',ci_bic(2,modelarray)'-mean(diffbic(modelarray,subarray),2),'k','linestyle','none','Linewidth',1);
set(gca,'XAxisLocation','origin');
set(gca,'xtick',1:modelnum,'xticklabel',{'Opt','Num','Prop','Num-V','Prop-V','Prop-V-risk'})
set(gca,'fontsize',10);
xlabel('Model'); ylabel('AICc difference');
xtickangle(-45)
xlim([0 numel(modelarray)+1])
set(gca,'tickdir','out');
set(gca,'linewidth',1);
set(gca,'fontsize',20);
