% This script performs the Bayesian model selection analysis.
% It uses functions in the VBA-toolbox
% (https://github.com/MBB-team/VBA-toolbox)

clear; close all;

% load AICc values
exp = 1;
[subarray,obsnum] = fun_exp2subarray2obsnum(exp);

modelarray = 1:5;

for subnum = subarray
    for modelnum = modelarray
        load(['fittingresult/' fun_modelnum2name(modelnum) '_sub' num2str(subnum) '.mat']);
        [aicc(modelnum,subnum),bic(modelnum,subnum)] = fun_aiccbic(- minusloglik_min,numel(p_min),obsnum);
    end
end

% convert AIC to log model evidence
lme = -aicc(modelarray,subarray)/2;

% BMS calculation
options.DisplayWin = false;
[posterior,out] = VBA_groupBMC(lme,options);

% estimated model frequency
disp(posterior.a/sum(posterior.a));

% protected exceedance probabilities
PEP = (1-out.bor)*out.ep + out.bor/length(out.ep);
disp(PEP);
