 % FIG_thres30 plots Fig 3d and 3h and all their counterparts

clear;

exp = 1;
[subarray,obsnum] = fun_exp2subarray2obsnum(exp);

threshold_flex = nan(9,10,max(subarray));

for subnum = subarray
    i = 1;
    for N = 5:10
        load(['fittingresult/Flexible-Threshold model/thres39_sub' num2str(subnum) '.mat']);
        threshold_flex(1:N-1,N,subnum) = p_min(i:i+N-2);
        i = i+N-1;
    end
end

% plot thresholds as a function of number of daysleft
figh = 100*3;
figw = 120*3;
figure('position',[100 100 figw figh]); hold on;
for N = 5:10
    errorbar(1:N-1,mean(threshold_flex(1:N-1,N,subarray),3),std(threshold_flex(N-1:-1:1,N,subarray),0,3)/sqrt(length(subarray)),'LineWidth',2);
end
xlabel('Number of days left'); ylabel('Threshold of r*');
ylim([1 5]); xlim([0.5 9.5])
set(gca,'fontsize',9);
set(gca,'tickdir','out');
set(gca,'linewidth',1);
set(gca,'xtick',1:9)
set(gca,'Xdir','reverse')
set(gca,'fontsize',20);
% legend(' T = 5',' T = 6',' T = 7',' T = 8',' T = 9',' T = 10'); legend boxoff;

% plot thresholds as a function of proportion of days left
figh = 100*3;
figw = 120*3;
figure('position',[100 100 figw figh]); hold on;
for N = 5:10
    errorbar((1:N-1)/N,mean(threshold_flex(1:N-1,N,subarray),3),std(threshold_flex(N-1:-1:1,N,subarray),0,3)/sqrt(length(subarray)),'LineWidth',2);
end
xlabel('Proportion of days left'); ylabel('Threshold of r*');
ylim([1 5]); xlim([0.05 0.95])
set(gca,'fontsize',9);
set(gca,'tickdir','out');
set(gca,'linewidth',1);
set(gca,'xtick',0.1:0.1:0.9,'xticklabel',{'0.1','','0.3','','0.5','','0.7','','0.9'}); %{'','0.2','','0.4','','0.6','','0.8',''}
set(gca,'Xdir','reverse')
set(gca,'fontsize',20);
% legend(' T = 5',' T = 6',' T = 7',' T = 8',' T = 9',' T = 10'); legend boxoff;