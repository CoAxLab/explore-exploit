function simulation_optimal_policy()
% simulation_optimal_policy simulates the optimal policy and stores the
% results in the same format as the raw data of participants.

times = 100000;
rng('shuffle');
load('deltaV_optimal.mat');

simudata = zeros(times*45,8);
i = 1; trial = 0;
for totalday = 5:10
    for repeat = 1:times
        trial = trial + 1;
        reward = newrandn(); rstar = reward; avereward = reward;
        simudata(i,:) = [trial,totalday,1,nan,1,reward,rstar,avereward];
        i = i + 1;
        for days = 2:totalday
            deltaV = deltaVmat(round((rstar-1)/0.1+1),totalday-days+1);
            if deltaV > 0
                action = 1;
            else if deltaV < 0
                    action = 0;
                else
                    action = (rand>0.5)*1;
                end
            end
            reward = (action==1)*newrandn()+(action==0)*rstar;
            avereward = (avereward*(days-1)+reward)/days;
            rstar = max(rstar,reward);
            simudata(i,:) = [trial,totalday,days,nan,action,reward,rstar,avereward];
            i = i + 1;
        end
    end
end

save(['optimal_policy_simu' num2str(times) '.mat'],'simudata');
end

function r = newrandn()
r = roundn(randn(1)*0.6+3,-1);
if r<1; r=1; end
if r>5; r=5; end
end
